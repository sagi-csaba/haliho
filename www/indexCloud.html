<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>snode</title>
		<meta name="viewport" content="initial-scale=1, user-scalable=no, width=device-width">
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="css/fonts.css">
		<link rel="stylesheet" href="css/csagi.css">
		<link rel="stylesheet" href="css/w3.css">
		<link rel="stylesheet" href="css/piemenu.css">
		<link rel="stylesheet" href="css/animate.min.css">
		<style type="text/css" media="screen">
			html, body, div, span, applet, object, iframe,
			p, blockquote, pre,
			a, abbr, acronym, address, big, cite, code,
			del, dfn, em, img, ins, kbd, q, s, samp,
			small, strike, strong, sub, sup, tt, var,
			b, u, i, center,
			dl, dt, dd, ol, ul, li,
			fieldset, form, label, legend,
			table, caption, tbody, tfoot, thead, tr, th, td,
			article, aside, canvas, details, embed, 
			figure, figcaption, footer, header, hgroup, 
			menu, nav, output, ruby, section, summary,
			time, mark, audio, video {font-family: 'Jura' !important; font-weight: 400 !important;}
			h1 {font-family: 'Jura' !important; font-weight: 700 !important;}
			h2 {font-family: 'Jura' !important; font-weight: 600 !important;}
			h3 {font-family: 'Jura' !important; font-weight: 500 !important;}
			h4,h5,h6 {font-family: 'Jura' !important; font-weight: 300 !important;}
			article {font-family: 'Jura';}
		
		
		@media screen and (max-width: 299px) and (min-width: 10px) {
			.bgr {
			  background-color: #000;
			  height: 200px;
			  width: 100%;
			  background: url(img/livingroomH.jpg); 
			  background-position: top center;
			  background-attachment: fixed;
			  background-repeat: no-repeat;
			  background-size: 100%;
			}
		}
		
		
		@media screen and (max-width: 629px) and (min-width: 300px) {
			.bgr {
			  background-color: #000;
			  height: 200px;
			  width: 100%;
			  background: url(img/livingroom.jpg); 
			  background-position: top center;
			  background-attachment: fixed;
			  background-repeat: no-repeat;
			  background-size: 100%;
			}
		}
		
		@media screen and (max-width: 2399px) and (min-width: 630px) {
			.bgr {
			  background-color: #000;
			  height: 200px;
			  width: 100%;
			  background: url(img/livingroomw.jpg); 
			  background-position: top center;
			  background-attachment: fixed;
			  background-repeat: no-repeat;
			  background-size: 100%;
			}
		}
		
		.animhossz {
		  animation-duration:1s;
		}
		
		.textDecor {
			text-shadow: 0px 0px 5px white, 0 0 30px gray, 0 0 15px gray;
		}
		
		.textDecor2 {
			text-shadow: 0px 0px 5px black, 0 0 20px gray, 0 0 10px gray;
		}
		
		.imgShadow {
			-webkit-filter: drop-shadow(0px 0px 40px #eee);
			filter: drop-shadow(0px 0px 40px #eee);
		}
		
		.kivalgosodas {
			
			-moz-transition: all 0.5s ease-in;
			-webkit-transition: all 0.5s ease-in;
			-o-transition: all 0.5s ease-in;
			transition: all 0.5s ease-in;
		}
		
		.linewithshadow {
			border-top: 1px solid #d6d6d6;
			-webkit-box-shadow: 0px -8px 30px rgba(50, 50, 50, 0.75);
			-moz-box-shadow: 0px -8px 30px rgba(50, 50, 50, 0.75);
			box-shadow: 0px -8px 30px rgba(50, 50, 50, 0.75);
			
		}
		#footer {
			position: fixed;
			bottom: 0;
			width: 100%;
			background: #eee;
			border-top: 1px solid #d1d1d1;
		}
		
		#settings {
			position: fixed;
			top: 0;
			right: 10;
			width: 25%;
			text-align: right;
			
		}
		
		#settings2 {
			position: absolute;
			top: 5px;
			right: 15px;
			width: 25%;
			text-align: right;
			text-shadow: 0px 0px 30px red, 0 0 20px #FF5555, 0 0 8px #FF5555;
			font-size: 18px;
			cursor: pointer;
		}
		
		.kocka {
			width: 150px;
			height: 150px;
			border-radius: 5px;
			background: white;
			display: inline-block;
			margin: 10px;
			transition: all 0.2s ease-in-out;
			cursor: pointer;
			-webkit-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			user-select: none; 
		}
			
		.kocka:active, kocka h1:active {
			-ms-transform: scale(0.9);
			-webkit-transform: scale(0.9); 
			transform: scale(0.9); 
			transition: all 0.2s ease-in-out;
			background: #ffcccc;
			cursor: pointer;
		}
		
		.beallitasokBtn {
			margin-top:50px;
			font-size: 14px;
			width: 160px;
			height: 26px;
			border-radius: 5px;
			background: #606060;
			color: #eee;
			display: block;
			transition: all 0.2s ease-in-out;
			cursor: pointer;
			-webkit-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			user-select: none; 
		}
		
		.beallitasokBtn:active, beallitasokBtn h2:active {
			-ms-transform: scale(0.9);
			-webkit-transform: scale(0.9); 
			transform: scale(0.9); 
			transition: all 0.2s ease-in-out;
			background: #ffcccc;
			cursor: pointer;
			color: #111;
		}
		
		.settingsBtn {
			display: inline-block;
			width:50px;
			height: 28px;
			padding-bottom: 4px;
			border-radius: 2px;
			background: #d6d6d6;
			-webkit-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			user-select: none; 
			cursor: pointer;
			transition: all 0.2s ease-in-out;
		}
		
		.settingsBtn:active {
			transition: all 0.2s ease-in-out;
			-ms-transform: scale(0.9);
			-webkit-transform: scale(0.9); 
			transform: scale(0.9); 
			transition: all 0.2s ease-in-out;
			background: #ffcccc;
		}
		
		.ikon {
			width: 60px;
			height: 60px;
			border-radius: 30px;
			border-color: gray;
			border-style: solid;
			border-width: 1px;
			top:10px;
			left:85px;
			position: relative;
		}
		
		.ikonImg {
			margin-top: 6px;
			margin-left: 6px;
			height: 46px;
			width: 46px;
		}
		
		.closeX {
			color: #f1f1f1;
			display: inline-block;
			text-align: center;
			-webkit-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			user-select: none; 
			cursor: pointer;
			width: 100px;
			padding: 5px;
			font-size: 22px;
			font-weight: bold;
			transition: 0.3s;
			z-index: 99999;
			background: #ff5555;
			border-radius: 3px;
		}

		.closeX:hover,
		.closeX:focus {
			background-color: #111;
			text-decoration: none;
			cursor: pointer;
		}
		
		.closeX:active {
			transition: all 0.2s ease-in-out;
			-ms-transform: scale(0.8);
			-webkit-transform: scale(0.8); 
			transform: scale(0.8); 
			transition: all 0.2s ease-in-out;
		}
		
		
		.closeX2 {
			color: #f1f1f1;
			display: inline-block;
			text-align: center;
			-webkit-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			user-select: none; 
			cursor: pointer;
			width: 90%;
			padding: 3px;
			font-size: 12px;
			transition: 0.3s;
			z-index: 99999;
			background: #ff5555;
			border-radius: 3px;
			margin-top:5px;
			margin-bottom: 15px;
		}

		.closeX2:hover,
		.closeX2:focus {
			background-color: #111;
			text-decoration: none;
			cursor: pointer;
		}
		
		.closeX2:active {
			transition: all 0.2s ease-in-out;
			-ms-transform: scale(0.9);
			-webkit-transform: scale(0.9); 
			transform: scale(0.9); 
			transition: all 0.2s ease-in-out;
		}
		
		.closeX3 {
			color: #f1f1f1;
			display: inline-block;
			text-align: center;
			-webkit-user-select: none;
			-moz-user-select: none; 
			-ms-user-select: none; 
			user-select: none; 
			cursor: pointer;
			width: 90%;
			padding: 3px;
			font-size: 12px;
			transition: 0.3s;
			z-index: 99999;
			background: #bb1111;
			border-radius: 3px;
			margin-top:5px;
			margin-bottom: 15px;
		}

		.closeX3:hover,
		.closeX3:focus {
			background-color: #111;
			text-decoration: none;
			cursor: pointer;
		}
		
		.closeX3:active {
			transition: all 0.2s ease-in-out;
			-ms-transform: scale(0.9);
			-webkit-transform: scale(0.9); 
			transform: scale(0.9); 
			transition: all 0.2s ease-in-out;
		}
		
		
		.select-style {
			border: 1px solid #ccc;
			width: 100%;
			border-radius: 3px;
			overflow: hidden;
			display: block;
		}

		.select-style select {
			padding: 5px 8px;
			width: 100%;
			border: none;
			box-shadow: none;
			background: #eee;
			background-image: none;
			-webkit-appearance: none; 
		    -moz-appearance: none;
		    appearance: none; 
			color: #707070;
		}

		.select-style select:focus {
			outline: none;
		}

		</style>
    </head>
	
    <body style="background:#eee;animation-duration:1.5s" class="animated fadeIn">
		
		
		<div id="myModal" class="" style="width:100%; height:100%;  background-color: rgb(255,255,255); z-index: 1010; display: none; position:fixed; left:0; top:0;overflow:auto;padding:5px;">
			<h2 style="background-color:#bababa;"><img src="img/settings.svg" style="height:28px;margin-left:14px;margin-right:10px;margin-top:-10px;">Beállítások</h2>
			<hr>
			 <div class="w3-card-4" style="margin:10px;">
				<div class="w3-container" style="background:#d6d6d6;">
					<h4><img src="img/cloud.svg" style="height:20px;margin-right:10px;margin-top:-10px;">MQTT felhő szerver</h4>
				</div>
				<form class="w3-container">
					<div style="display:flex;">
						<label  style="flex: 1;text-align:right;margin-top:17px;margin-right:5px;font-size:0.8em;">Szerver: </label>
						<input id="settingsMqttServerInput" name="settingsMqttServerInput" class="w3-input" style="margin-bottom:10px;color:#707070;margin-top:10px;flex: 2;background:#eee;border-radius:3px;" type="text">
					</div>
					
					<div style="display:flex;">
						<label style="flex: 1;text-align:right;margin-top:17px;margin-right:5px;font-size:0.8em;">Port: </label>
						<input id="settingsMqttPortInput" name="settingsMqttPortInput" class="w3-input" style="margin-bottom:10px;color:#707070;margin-top:10px;flex: 2;background:#eee;border-radius:3px;" type="text">
					</div>
					
					<div style="display:flex;">
						<label style="flex: 1;text-align:right;margin-top:17px;margin-right:5px;font-size:0.8em;">Felhasználó: </label>
						<input id="settingsMqttUserInput" name="settingsMqttUserInput" class="w3-input" style="margin-bottom:10px;color:#707070;margin-top:10px;flex: 2;background:#eee;border-radius:3px;" type="text">
					</div>
					
					<div style="display:flex;">
						<label style="flex: 1;text-align:right;margin-top:17px;margin-right:5px;font-size:0.8em;">Jelszó: </label>
						<input id="settingsMqttPwdInput" name="settingsMqttPwdInput" class="w3-input" style="margin-bottom:10px;color:#707070;margin-top:10px;flex: 2;background:#eee;border-radius:3px;" type="text">
					</div>
					
					<div style="display:flex;">
						<label style="flex: 1;text-align:right;margin-top:17px;margin-right:5px;font-size:0.8em;">SZOBA: </label>
						<input id="settingsMqttTopicInput" name="settingsMqttTopicInput" class="w3-input" style="margin-bottom:10px;color:#707070;margin-top:10px;flex: 2;background:#eee;border-radius:3px;" type="text">
					</div>
					<center><div id="scanBtn" class="closeX2" onclick="scanQRcode()">Beállítások szkennelése QR kódról</div></center>
					<div style="margin-bottom:10px;color:gray;"><label style="font-size:0.8em;">MQTT Client ID: </label><label style="font-size:0.7em;" id = "mqttClientID" name = "mqttClientID"></label></div>
				</form>
				
				
			</div> 
			
			<div class="w3-card-4" style="margin:10px;margin-top:20px;padding-bottom:20px;">
				<div class="w3-container" style="background:#d6d6d6;">
					<h4><img src="img/user.svg" style="height:20px;margin-right:10px;margin-top:-10px;">Felhasználói beállítások</h4>
				</div>
				<form class="w3-container">
					<label>Alapértelmezett kezdőképernyő:</label>
					
					<div class="select-style">
					  <select id="StartUpScreenValue" name="StartUpScreenValue" onchange="settingsStartUpScreenChanged()">
						<option value="default">Indításnál kérdezzen rá</option>
						<option value="cloud">Felhő szerver</option>
						<option value="wifi">Lokális WiFi</option>
					  </select>
					</div>

					
					<label>Felhő szerver applikáció: szűrő állapota</label>
					<div class="select-style">
					  <select id="settingsCloudFilterValue"  name="settingsCloudFilterValue" onchange="settingsStartFilterChanged()">
						<option value="filterDefault">Indításkor mindig inaktív</option>
						<option value="filterLast">Utolsó szűrő megjegyzése</option>
					  </select>
					</div>
					
				</form>
			</div> 
			
			
			<div style="display: flex;margin-top:30px;">
				<div style="flex: 1;text-align:center;">
					<span class="closeX">Bezár</span>
				</div>
				<div style="flex: 1;text-align:center;">
					<div class="closeX" onclick="saveSettings()">Mentés</div>
				</div>
			</div>		  
		</div>
		
		<div id="myModal2" class="" style="width:100%; height:100%;  background-color: rgb(255,255,255); background-color: rgba(255,255,255, 1); z-index: 1010; display: none; position:fixed; left:0; top:0;overflow:auto;padding:5px;">
			<div id="logTxtDiv" style="font-size:0.7em;"></div>
			
			<div style="display: flex;margin-top:30px;">
				<div style="flex: 1;text-align:center;">
					<span class="closeX" onclick="closeWheel()">Bezár</span>
				</div>
				<div style="flex: 1;text-align:center;">
					
				</div>
			</div>		
		</div>
		
		<div id="myModalWS" class="" style="width:100%; height:100%;  background-color: rgb(255,255,255); background-color: rgba(255,255,255, 1); z-index: 1010; display: none; position:fixed; left:0; top:0;overflow:auto;padding:5px;background-image:url('img/ws_bgw.jpg');background-size:100% 100%;">
			 <div style="margin:5px;">
				 <center><div id="wsName">...</div></center>
				 <div style="display: flex;">
					<div style="flex: 1;text-align:center;">
						<img src="img/pictogram_temp.png" style="max-height:55px;margin-top:-30px;"><div id="actualTemp" name="actualTemp" style="display:inline-block;font-size:4em;">--</div>&#x2103;<br>
					</div>
					<div style="flex: 1;text-align:center;margin-top:33px;">
						<img src="img/pictogram_drop.png" style="max-height:30px;margin-top:-15px;"> <div id="actualHumidity" name="actualHumidity" center style="display:inline-block;font-size:2em;">--</div>%<br> 
					</div>
					
				</div>	
			 	
				<div style="margin-top:35px;"><canvas id="myChart" name="myChart" width="30" height="15"></canvas></div>
				
			</div>
			<center><div id="actualChartType"></div></center>
			<div style="display: flex;margin-top:30px;">
				<div style="flex: 1;text-align:center;">
					<span id="btnWS_last4hours" class="closeX3" onclick="UpdateSnodeWSHistorie24h()">utolsó 4 óra</span>
				</div>
				<div style="flex: 1;text-align:center;">
					<span class="closeX3" onclick="UpdateSnodeWSHistorie3d()">utolsó 8 óra</span>
				</div>
				<div style="flex: 1;text-align:center;">
					<span class="closeX3" onclick="UpdateSnodeWSHistorie7d()">utolsó 12 óra</span>
				</div>
			</div>	
			
			
			<div style="display: flex;margin-top:30px;">
				<div style="flex: 1;text-align:center;">
					<span class="closeX" onclick="closemyModalWS()">Bezár</span>
				</div>
			</div>		
		</div>
		
		
		
	<script type="text/javascript" src="cordova.js"></script>
	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/jquery.menu.js"></script>
	<script src="js/jquery-ui-1.8.20.custom.min.js"></script>
	<script src="js/Chart.min.js"></script>
	<script type="text/javascript">
		function PieMenuInit(){		
			$('#outer_container').PieMenu({
				'starting_angel':$('#s_angle').val(),
				'angel_difference' : $('#diff_angle').val(),
				'radius':$('#radius').val(),
			});			
		}
		
		$(function() {          
			$("#submit_button").click(function() {reset(); }); 
			$( "#outer_container" ).draggable();
			PieMenuInit();
			
		});
		function reset(){
			if($(".menu_button").hasClass('btn-rotate'))
			$(".menu_button").trigger('click');
			
			$("#info").fadeIn("slow").fadeOut("slow");
			PieMenuInit();
			}
			
			setTimeout(function(){
						document.body.style.backgroundColor = '#d9d9d9';
					},1);
					
			function switchToWifiService() {
				//document.getElementById('main').className = "animated zoomOut";
				document.body.className = "animated fadeOut";
				
				setTimeout(function(){
						window.location = "indexWiFi.html";
					},100);
				
			}
			
			var valaszHistorie = 'ures';
			var modal = document.getElementById('myModal');
			var modal2 = document.getElementById('myModal2');
			var modalWS = document.getElementById('myModalWS');
			var span = document.getElementsByClassName("closeX")[0];
			function showSettings() {
				modal.style.display = "block";
				modal.className = "w3-animate-zoom";
			}
			
			function showModalWS() {
				modalWS.style.display = "block";
				modalWS.className = "animated fadeInUp";
			}
			
			span.onclick = function() { 
				
				modal.className = "animated zoomOut";
				setTimeout(function(){
					modal.style.display = "none";
				},300);
			}
			
			function showWheel() {
				modal2.style.display = "block";
				modal2.className = "w3-animate-zoom";
			}
			
			function closeWheel() {
				modal2.style.display = "none";
			}
			
			function closemyModalWS() {
				logging('Részletes időjárás adatok elrejtve');
				modalWS.className = "animated fadeOutDown";
				setTimeout(function(){
					modalWS.style.display = "none";
				},500);
				
			}
			
			var randomName = "snodeApp_";
			var settingsMqttServer = ""; //"m21.cloudmqtt.com";
			var settingsMqttPort = 0; //18439;
			var settingsMqttUser = ""; //"sskmhwoi";
			var settingsMqttPwd = ""; //"QSuPFnVjylqr";
			var settingsStartUpScreen = "default";
			var settingsCloudFilter = "filterDefault";
			var settingsLastFilter = "none";
			var settingsMqttTopic = ""; //"HOME";
			function onLoad() {
					document.addEventListener("deviceready", onDeviceReady, false);
					document.addEventListener("connected", onCloudConnected, false);
					
					var storage = window.localStorage;
					var valueRandom = storage.getItem('randomName');
					if (valueRandom != null) {randomName = valueRandom;} 
					else {
						randomName = "snodeApp_" + Math.random().toString(36).substr(2,5);
						storage.setItem('randomName', randomName);
					}
					document.getElementById('mqttClientID').innerHTML = randomName;
					
					/* SETTINGS */
					settingsMqttServerValue = storage.getItem('settingsMqttServer');
						if (settingsMqttServerValue != null) {settingsMqttServer = settingsMqttServerValue;} 
					document.getElementById('settingsMqttServerInput').value = settingsMqttServer;
						
					settingsMqttPortValue = storage.getItem('settingsMqttPort');
						if (settingsMqttPortValue != null) {settingsMqttPort = settingsMqttPortValue;}
					document.getElementById('settingsMqttPortInput').value = settingsMqttPort;
						
					settingsMqttUserValue = storage.getItem('settingsMqttUser');
						if (settingsMqttUserValue != null) {settingsMqttUser = settingsMqttUserValue;} 
					document.getElementById('settingsMqttUserInput').value = settingsMqttUser;
						
					settingsMqttPwdValue = storage.getItem('settingsMqttPwd');
						if (settingsMqttPwdValue != null) {settingsMqttPwd = settingsMqttPwdValue;}
					document.getElementById('settingsMqttPwdInput').value = settingsMqttPwd;
					
					settingsMqttTopicValue = storage.getItem('settingsMqttTopic');
						if (settingsMqttTopicValue != null) {settingsMqttTopic = settingsMqttTopicValue;}
					document.getElementById('settingsMqttTopicInput').value = settingsMqttTopic;
					
					//alert(settingsMqttTopicValue);
					
					setTimeout(function(){
						for (var i=1; i<= 10; i++) {
						document.getElementById('kocka' + i + 'szoba').innerHTML = settingsMqttTopicValue;
						}
					}, 1); 
					
					
					var settingsStartUpScreenValue = storage.getItem('settingsStartUpScreen');
						if (settingsStartUpScreenValue != null) {
							settingsStartUpScreen = settingsStartUpScreenValue;
							if (settingsStartUpScreen == 'default') {document.getElementById('StartUpScreenValue').value = 'default'; }
							if (settingsStartUpScreen == 'cloud') {document.getElementById('StartUpScreenValue').value = 'cloud'; }
							if (settingsStartUpScreen == 'wifi') {document.getElementById('StartUpScreenValue').value = 'wifi'; }
						}
						
					var settingsCloudFilterValue = storage.getItem('settingsCloudFilter');
						if (settingsCloudFilterValue != null) {
							
							settingsCloudFilter = settingsCloudFilterValue;
							if (settingsCloudFilter == 'filterDefault' ) {document.getElementById('settingsCloudFilterValue').value = 'filterDefault'; }
							if (settingsCloudFilter == 'filterLast' ){
								document.getElementById('settingsCloudFilterValue').value = 'filterLast'; 
								settingsLastFilter = storage.getItem('settingsLastFilter');
								
								setTimeout(function(){
										setFilter(settingsLastFilter);
								},1);
							}
						}
				}
			onLoad();
			
			function onDeviceReady() {
				connectAndRefreshCloud();
			}
			
			function settingsStartUpScreenChanged() {
				var newValue = document.getElementById('StartUpScreenValue').value;
				if (newValue == 'default') {settingsStartUpScreen = 'default';}
				if (newValue == 'cloud') {settingsStartUpScreen = 'cloud';}
				if (newValue == 'wifi') {settingsStartUpScreen = 'wifi';}
			}
			
			function settingsStartFilterChanged() {
				var newValue = document.getElementById('settingsCloudFilterValue').value;
				if (newValue == 'filterDefault') {settingsStartUpScreen = 'filterDefault';}
				if (newValue == 'filterLast') {settingsStartUpScreen = 'filterLast';}
			}
			
			function saveSettings() {
				var storage = window.localStorage;
				
				settingsMqttServer = document.getElementById('settingsMqttServerInput').value;
				storage.setItem('settingsMqttServer', settingsMqttServer);
				
				settingsMqttPort = document.getElementById('settingsMqttPortInput').value;
				storage.setItem('settingsMqttPort', settingsMqttPort);
				
				settingsMqttUser = document.getElementById('settingsMqttUserInput').value;
				storage.setItem('settingsMqttUser', settingsMqttUser);
				
				settingsMqttPwd = document.getElementById('settingsMqttPwdInput').value;
				storage.setItem('settingsMqttPwd', settingsMqttPwd);
				
				settingsMqttTopic = document.getElementById('settingsMqttTopicInput').value;
				storage.setItem('settingsMqttTopic', settingsMqttTopic);
			
				var newValue = document.getElementById('StartUpScreenValue').value;
				if (newValue == 'default') {settingsStartUpScreen = 'default';}
				if (newValue == 'cloud') {settingsStartUpScreen = 'cloud';}
				if (newValue == 'wifi') {settingsStartUpScreen = 'wifi';}
				storage.setItem('settingsStartUpScreen', settingsStartUpScreen);
				
				
				var newValue2 = document.getElementById('settingsCloudFilterValue').value;
				if (newValue2 == 'filterDefault') {settingsCloudFilter = 'filterDefault';}
				if (newValue2 == 'filterLast') {settingsCloudFilter = 'filterLast';}
				storage.setItem('settingsCloudFilter', settingsCloudFilter);
				
				alert('A beállítások mentve. A módosítások érvénybe léptetéséhez frissítsd az eszközök listáját!');
			
			}
			
			var sikerultKapcsolodni = '0';
			
			function connectAndRefreshCloud() {
				
				//var cloudStatusIcon = document.getElementById('cloudStatusImage');
				sikerultKapcsolodni = '0';
				var cloudStatusI = document.getElementById('cloudStatus');
				cloudStatusI.style.backgroundImage = 'url(img/cloudSrefresh.svg)';
				//cloudStatusIcon.src = 'img/cloudSrefresh.svg';
				logging("Kapcsolódás a felhő szerverhez...");
				logginToLog("Kapcsolódás a felhő szerverhez");
				cordova.plugins.CordovaMqTTPlugin.connect({
						url:"tcp://" + settingsMqttServer, 
						port: settingsMqttPort,
						clientId:randomName,
						connectionTimeout:3000,
						willTopicConfig:{
							qos:0, //default is 0
							retain:true, //default is true
							topic:settingsMqttTopic,
							payload:"snodeAnroidApp"
						},
						username:settingsMqttUser,
						password:settingsMqttPwd,
						keepAlive:60,
						success:function(s){
							logging("Kapcsolódva a felhő szerverhez!!!");
							logginToLog("Kapcsolódva a felhő szerverhez");
							//cloudStatusIcon.src = 'img/cloudSonline.svg';
							sikerultKapcsolodni = '1';
							cloudStatusI.style.backgroundImage = 'url(img/cloudSonline.svg)';
							cordova.plugins.CordovaMqTTPlugin.subscribe({
							   topic:settingsMqttTopic,
							   qos:0,
							  success:function(s){
								logging("Csatlakozva a HOME szobához");
								//logginToLog("Csatlakozva a HOME szobához");
							  },
							  error:function(e){
								//logging("--- HIBA a HOME szobába lépéskor! ---");
								//cloudStatusIcon.src = 'img/cloudSoffline.svg';
								cloudStatusI.style.backgroundImage = 'url(img/cloudSoffline.svg)';
								logginToLog("--- HIBA a HOME szobába lépéskor! ---");
							  }
							});
							
							
							cordova.plugins.CordovaMqTTPlugin.publish({
							   topic:settingsMqttTopic,
							   payload:"tellMeYourSnodeStatus",
							   qos:0,
							   retain:false,
							  success:function(s){
								//alert("elküldve a tellMeYourSnodeStatus szöveg");
								logginToLog("snode eszközök lekérdezése...");
								cloudStatusI.style.backgroundImage = 'url(img/cloudSonline.svg)';
							  },
							  error:function(e){
								logginToLog("--- HIBA az snode eszközök lekédezése során! ---");
								cloudStatusI.style.backgroundImage = 'url(img/cloudSoffline.svg)';
							  }
							});
							
							
							cordova.plugins.CordovaMqTTPlugin.listen(settingsMqttTopic,function(payload,params){
							  //Callback:- (If the user has published to /topic/room/hall)
							  //payload : contains payload data
							  //params : {singlewc:room,multiwc:hall}
							  //logging("most jott valami");
							  //logginToLog("most jott valami");
							  //alert(payload);
							  // ****************--- itt érkezett üzenet **********************
							  logginToLog("Üzenet érkezett:  '" + payload + "'");
							  var payloadString = String(payload);
							  
							  if (payloadString.indexOf('snodeDeviceHistory') != -1) {
								// ha a valasz tartalmazza a snodeDeviceHistory szot; akkor nem a fo lapot, hanem valamelyik melleklapot kell frissiten
								
								if (document.getElementById('myModalWS').style.display == 'none') {logginToLog('return; mert a myModalWS display=none');return;}	//ha nem lathato az idojaras ablak, akkor ne csinaljon semmit sem
								
								if (payloadString.indexOf('_WS') != -1) {
									//idojaras allomasrol erkezett historie adat
									
									valaszHistorie = payloadString.replace('snodeDeviceName:','').replace('snodeDeviceHistory:',''); 
									logginToLog('valaszHistorie = ' + valaszHistorie);
									//UpdateSnodeWSHistorie(payloadString); // helyette a gombok fogjak vezerelni
								}
								
								if (payloadString.indexOf('_valami_aminek_van_meg_historie_adatlapja') != -1) {
								
								}
								
								
							  }
							  else {
								//ha nem a melleklapra erkezik frissites, akkor bizony a folapot kell frissiteni
								UpdateSnodeDevice(payloadString);
							  }
							})
							
							
						},
						error:function(e){
							
							if (sikerultKapcsolodni == '0') {
								logginToLog("--- A felhő szervehez kapcsolódás SIKERTELEN! --- ");
								cloudStatusI.style.backgroundImage = 'url(img/cloudSoffline.svg)';
								logging("--- A felhő szervehez kapcsolódás SIKERTELEN! --- ");
							}
						},
						onConnectionLost:function (){
							logging("--- A felhő szerverrel a kapcsolat MEGSZAKADT! ---");
							logginToLog("--- A felhő szerverrel a kapcsolat MEGSZAKADT! ---");
							//cloudStatusIcon.src = 'img/cloudSoffline.svg';
							cloudStatusI.style.backgroundImage = 'url(img/cloudSoffline.svg)';
						}
					});
				
			}
			
			function UpdateSnodeDevice(payload) {
				if (payload.indexOf('snodeDeviceName') != -1) {
					//olyan valasz erkezett, amit tudok ertelmezni
					
					if (payload.indexOf('_WS') != -1) {
						//időjárás állomástól jött válasz
						
						var tempArray = payload.split(';');
						var snodeDeviceName = tempArray[0].replace('snodeDeviceName:','');;    	//<-	hőmérséklet eszköz neve
						var snodeDeviceName2 = snodeDeviceName.replace('_WS','_DROP');			//<-	páratartalom eszköz neve
						var tempResult = tempArray[1].replace('snodeDeviceStatus:','');
						var tempResultArray = tempResult.split('-');
						var snodeDeviceValue = tempResultArray[0].replace('-','');				//<-	hőmérséklet érték
						var snodeDeviceValue2 = tempResultArray[1].replace('-','');				//<-	páratartalom érték
						logginToLog("hőmérséklet eszköz neve: " + snodeDeviceName);
						logginToLog("hőmérséklet érték: " + snodeDeviceValue);
						logginToLog("páratartalom eszköz neve: " + snodeDeviceName2);
						logginToLog("páratartalom érték: " + snodeDeviceValue2);
						
						var vanMarIlyen = 'nincs';
						for (var i = 1; i<=10; i++)
						{
							var csempe = document.getElementById('kocka' + i);
							var csempeneve = 'kocka' + i;
							var csempeTypeValue = document.getElementById('kocka' + i + 'type').innerHTML;
								if (csempeTypeValue != 'ismeretlen') {
									var csempeDevinceName = document.getElementById('kocka' + i + 'nev').innerHTML;
									if (csempeDevinceName == snodeDeviceName) {
										//a látható csempe eszközének neve megegyezik a device nevével, ami most küldött parancsot
										//frissíteni kell az értékeket és készen is vagyunk!
										document.getElementById('kocka' + i + 'ertek').innerHTML = snodeDeviceValue;
										//csempe.className = "kocka";
										//csempe.className = "kocka animated flash";
										$('#' + csempeneve).removeClass().addClass('kocka flash animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
										  $(this).removeClass().addClass('kocka');
										});
										vanMarIlyen = 'van';
										logging("Frissítve: " + snodeDeviceName);
										
									}
									if (csempeDevinceName == snodeDeviceName2) {
										//a látható csempe eszközének neve megegyezik a device2 nevével, ami most küldött parancsot
										//frissíteni kell az értékeket és készen is vagyunk!
										document.getElementById('kocka' + i + 'ertek').innerHTML = snodeDeviceValue2;
										//csempe.className = "kocka";
										//csempe.className = "kocka animated flash";
										$('#' + csempeneve).removeClass().addClass('kocka flash animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
										  $(this).removeClass().addClass('kocka');
										});
										vanMarIlyen = 'van';
										logging("Frissítve: " + snodeDeviceName2);
									}
								
								}
						}
						//executeFilter(generalFilerValue);
						if (vanMarIlyen == 'van') {return;} //kilépek, hogy ne adja hozzá mégegyszer
						
						//ha a for ciklus végén a vanMarIlyen még 'nincs' értéken van, akkor létre kell hozni egy csempét az eszköznek
						//méghozzá úgy, hogy végig kell menni a 10 csempén és az első, ami nem látható abba kell beletenni
						for (var j = 1; j <= 10; j++) {
							var csempe = document.getElementById('kocka' + j);
							var csempeTypeValue = document.getElementById('kocka' + j + 'type').innerHTML;
							if (csempe.style.display == 'none' && csempeTypeValue == 'ismeretlen') {
								//az első csempe a sorban aminek a láthatósága null
								csempe.style.display = 'inline-block';
								csempe.className = "kocka animated bounceIn";
								var k = j + 1;
								var csempe2 = document.getElementById('kocka' + k);
								csempe2.style.display = 'inline-block';
								csempe2.className = "kocka animated bounceIn";
								
								document.getElementById('kocka' + j + 'nev').innerHTML = snodeDeviceName;
								document.getElementById('kocka' + j + 'type').innerHTML = "WS";
								document.getElementById('kocka' + j + 'ertek').innerHTML = snodeDeviceValue;
								document.getElementById('kocka' + j + 'ertekS').innerHTML = '&#x2103;';
								document.getElementById('kocka' + j + 'icon').src = 'img/icon_WS.svg';
								logging("Eszköz hozzáadva: " + snodeDeviceName);
								
								document.getElementById('kocka' + k + 'nev').innerHTML = snodeDeviceName2;
								document.getElementById('kocka' + k + 'type').innerHTML = "DROP";
								document.getElementById('kocka' + k + 'ertek').innerHTML = snodeDeviceValue2;
								document.getElementById('kocka' + k + 'ertekS').innerHTML = '%';
								document.getElementById('kocka' + k + 'icon').src = 'img/icon_DROP.svg';
								logging("Eszköz hozzáadva: " + snodeDeviceName2);
								executeFilter(generalFilerValue);
								return;
							}
						
						}
					}
					
					if (payload.indexOf('_SP') != -1) {
						//okos konnektortól érkezett válasz
						var tempArray = payload.split(';');
						var snodeDeviceName = tempArray[0].replace('snodeDeviceName:','');;    	//<-	okos konnektor neve
						var tempResult = tempArray[1].replace('snodeDeviceStatus:','');
						var snodeDeviceValue = tempResult;										//<-	okos konnektor állapota
						
						logginToLog("okos konnektor neve: " + snodeDeviceName);
						logginToLog("okos konnektor állapota: " + snodeDeviceValue);
						
						var vanMarIlyen = 'nincs';
						for (var i = 1; i<=10; i++)
						{
							var csempe = document.getElementById('kocka' + i);
							var csempeneve = 'kocka' + i;
							var csempeTypeValue = document.getElementById('kocka' + i + 'type').innerHTML;
								if (csempeTypeValue != 'ismeretlen') {
									var csempeDevinceName = document.getElementById('kocka' + i + 'nev').innerHTML;
									if (csempeDevinceName == snodeDeviceName) {
										//a látható csempe eszközének neve megegyezik a device nevével, ami most küldött parancsot
										//frissíteni kell az értékeket és készen is vagyunk!
										
										if (snodeDeviceValue == '0') {
											document.getElementById('kocka' + i + 'ertek').innerHTML = 'KI';
											document.getElementById('kocka' + i + 'iconConatiner').style.background = '#ffcccc';
											} 
										if (snodeDeviceValue == '1') {
											document.getElementById('kocka' + i + 'ertek').innerHTML = 'BE';
											document.getElementById('kocka' + i + 'iconConatiner').style.background = '#99ff99';
											} 
										
										$('#' + csempeneve).removeClass().addClass('kocka flash animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
										  $(this).removeClass().addClass('kocka');
										});
										vanMarIlyen = 'van';
										logging("Frissítve: " + snodeDeviceName);
									}
								}
						}
						//executeFilter(generalFilerValue);
						if (vanMarIlyen == 'van') {return;} //kilépek, hogy ne adja hozzá mégegyszer
						
						//ha a for ciklus végén a vanMarIlyen még 'nincs' értéken van, akkor létre kell hozni egy csempét az eszköznek
						//méghozzá úgy, hogy végig kell menni a 10 csempén és az első, ami nem látható abba kell beletenni
						for (var j = 1; j <= 10; j++) {
							var csempe = document.getElementById('kocka' + j);
							var csempeTypeValue = document.getElementById('kocka' + j + 'type').innerHTML;
							if (csempe.style.display == 'none' && csempeTypeValue == 'ismeretlen') {
								//az első csempe a sorban aminek a láthatósága null
								csempe.style.display = 'inline-block';
								csempe.className = "kocka animated bounceIn";
								
								document.getElementById('kocka' + j + 'nev').innerHTML = snodeDeviceName;
								document.getElementById('kocka' + j + 'type').innerHTML = "SP";
								document.getElementById('kocka' + j + 'icon').src = 'img/icon_SP.svg';
								if (snodeDeviceValue == '0') {
											document.getElementById('kocka' + j + 'ertek').innerHTML = 'KI';
											document.getElementById('kocka' + j + 'iconConatiner').style.background = '#ffcccc';
											} 
										if (snodeDeviceValue == '1') {
											document.getElementById('kocka' + j + 'ertek').innerHTML = 'BE';
											document.getElementById('kocka' + j + 'iconConatiner').style.background = '#99ff99';
											} 
								document.getElementById('kocka' + j + 'ertekS').innerHTML = '';				
								logging("Eszköz hozzáadva: " + snodeDeviceName);
								executeFilter(generalFilerValue);
								return;
							}
						
						}
						
						
					}
					
					if (payload.indexOf('_RGBW') != -1) {
						//RGBW vezérlőtől jött válasz
						
						var tempArray = payload.split(';');
						var snodeDeviceName = tempArray[0].replace('snodeDeviceName:','');;    	//<-	rgbw controller neve
						var tempResult = tempArray[1].replace('snodeDeviceStatus:','');
						var snodeDeviceValue = tempResult;										//<-	rgbw controller állapota
						
						logginToLog("rgbw controller neve: " + snodeDeviceName);
						logginToLog("rgbw controller állapota: " + snodeDeviceValue);
						
						//"snodeDeviceName:nappali_RGBW;snodeDeviceStatus:0-0-255-255-255-0"  rgbw:BE/KI-feher:BE/KI-rrr-ggg-bbb-feherfenyero
						
						var vanMarIlyen = 'nincs';
						for (var i = 1; i<=10; i++)
						{
							var csempe = document.getElementById('kocka' + i);
							var csempeneve = 'kocka' + i;
							var csempeTypeValue = document.getElementById('kocka' + i + 'type').innerHTML;
								if (csempeTypeValue != 'ismeretlen') {
									var csempeDevinceName = document.getElementById('kocka' + i + 'nev').innerHTML;
									if (csempeDevinceName == snodeDeviceName) {
										//a látható csempe eszközének neve megegyezik a device nevével, ami most küldött parancsot
										//frissíteni kell az értékeket és készen is vagyunk!
										
										if (snodeDeviceValue.substring(0,3) == '0-0')
										{
											//kikapcsolva
											document.getElementById('kocka' + i + 'ertek').innerHTML = 'KI';
											document.getElementById('kocka' + i + 'iconConatiner').style.background = '#ffffff';
											document.getElementById('kocka' + i + 'ertekS').innerHTML = '';	
										}
										if (snodeDeviceValue.substring(0,3) == '1-0')
										{
											//rgb mode
											var tempRgbColor = payload.split('-');
											document.getElementById('kocka' + i + 'ertek').innerHTML = 'BE';
											var hexRed = tempRgbColor[2].toString(16);
											var hexGreen = tempRgbColor[3].toString(16);
											var hexBlue = tempRgbColor[4].toString(16);
											var ikonhatterszine = '#' + hexRed +hexGreen + hexBlue;
											logginToLog("rgbw controller jelenlegi színkódja: " + ikonhatterszine);
											document.getElementById('kocka' + i + 'iconConatiner').style.background = ikonhatterszine;
											document.getElementById('kocka' + i + 'ertekS').innerHTML = ' RGB';
										}
										if (snodeDeviceValue.substring(0,3) == '0-1')
										{
											//white mode
											var tempWhitePercentage = payload.split('-');
											document.getElementById('kocka' + i + 'ertek').innerHTML = tempWhitePercentage[5]  + '%';
											document.getElementById('kocka' + i + 'iconConatiner').style.background = '#ffffff';
											document.getElementById('kocka' + i + 'ertekS').innerHTML = ' Fehér';
										}
									
										$('#' + csempeneve).removeClass().addClass('kocka flash animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
										  $(this).removeClass().addClass('kocka');
										});
										vanMarIlyen = 'van';
										logging("Frissítve: " + snodeDeviceName);
									}
								}
						}
						
						//executeFilter(generalFilerValue);
						if (vanMarIlyen == 'van') {return;} //kilépek, hogy ne adja hozzá mégegyszer
						//ha a for ciklus végén a vanMarIlyen még 'nincs' értéken van, akkor létre kell hozni egy csempét az eszköznek
						//méghozzá úgy, hogy végig kell menni a 10 csempén és az első, ami nem látható abba kell beletenni
						for (var j = 1; j <= 10; j++) {
							var csempe = document.getElementById('kocka' + j);
							var csempeTypeValue = document.getElementById('kocka' + j + 'type').innerHTML;
							if (csempe.style.display == 'none' && csempeTypeValue == 'ismeretlen') {
								//az első csempe a sorban aminek a láthatósága null
								csempe.style.display = 'inline-block';
								csempe.className = "kocka animated bounceIn";
								
								document.getElementById('kocka' + j + 'nev').innerHTML = snodeDeviceName;
								document.getElementById('kocka' + j + 'type').innerHTML = "RGBW";
								document.getElementById('kocka' + j + 'icon').src = 'img/icon_RGBW.svg';
								
								if (snodeDeviceValue.substring(0,3) == '0-0')
										{
											//kikapcsolva
											document.getElementById('kocka' + j + 'ertek').innerHTML = 'KI';
											document.getElementById('kocka' + j + 'iconConatiner').style.background = '#ffffff';
											document.getElementById('kocka' + j + 'ertekS').innerHTML = '';				
										}
										
										
								if (snodeDeviceValue.substring(0,3) == '1-0')
										{
											//rgb mode
											var tempRgbColor = payload.split('-');
											document.getElementById('kocka' + j + 'ertek').innerHTML = 'BE';
											var hexRed = tempRgbColor[2].toString(16);
											var hexGreen = tempRgbColor[3].toString(16);
											var hexBlue = tempRgbColor[4].toString(16);
											var ikonhatterszine = '#' + hexRed +hexGreen + hexBlue;
											logginToLog("rgbw controller jelenlegi színkódja: " + ikonhatterszine);
											document.getElementById('kocka' + j + 'iconConatiner').style.background = ikonhatterszine;
											document.getElementById('kocka' + j + 'ertekS').innerHTML = ' RGB';
										}
										
								if (snodeDeviceValue.substring(0,3) == '0-1')
										{
											//white mode
											var tempWhitePercentage = payload.split('-');
											document.getElementById('kocka' + j + 'ertek').innerHTML = tempWhitePercentage[5]  + '%';
											document.getElementById('kocka' + j + 'iconConatiner').style.background = '#ffffff';
											document.getElementById('kocka' + j + 'ertekS').innerHTML = ' Fehér';
										}
											
								//document.getElementById('kocka' + j + 'ertekS').innerHTML = '';				
								logging("Eszköz hozzáadva: " + snodeDeviceName);
								executeFilter(generalFilerValue);
								return;
							}
						
						}
						
					}
					
					if (payload.indexOf('_RF') != -1) {
						//RF vezérlőtől jött válasz
					}
					
					
				}
			}
			
			function onCloudConnected() {
				logging("Kapcsolódva a felhő szerverhez.");
			}
			
			function executeFilter(type) {
				for (var i = 1 ; i <= 10; i++)
				{
					var kockai = document.getElementById('kocka' + i);
					var kockatype = document.getElementById('kocka' + i + 'type');
					if (type == 'none' && kockatype.innerHTML != 'ismeretlen')
					{
						
						kockai.style.display = 'inline-block';
						kockai.className = "kocka animated bounceIn";
						
						
					}
					else
					{
						if (type == kockatype.innerHTML) 
						{ 
							kockai.style.display = 'inline-block'; 
							kockai.className = "kocka animated bounceIn";
						}
						else
						{
							kockai.style.display = 'none'; 	
						}
					}
				}
			}
			
			var generalFilerValue = 'none';
			function setFilter(nr) {
				var ftb = document.getElementById("filterToggleBtn");
				if (nr == 'a')
				{
					generalFilerValue = "DROP";
					executeFilter("DROP");
					logging("Eszköz szűrő: PÁRATARTALOM");
					ftb.style.backgroundImage = 'url(img/icon_DROP.svg)';
				}
				if (nr == 'b')
				{
					generalFilerValue = "POWER";
					executeFilter("POWER");
					logging("Eszköz szűrő: KAPCSOLÓ");
					ftb.style.backgroundImage = 'url(img/icon_POWER.svg)';
				}
				if (nr == 'c')
				{
					generalFilerValue = "RF";
					executeFilter("RF");
					logging("Eszköz szűrő: RF VEZÉRLŐ");
					ftb.style.backgroundImage = 'url(img/icon_RF.svg)';
				}
				if (nr == 'd')
				{
					generalFilerValue = "RGBW";
					executeFilter("RGBW");
					logging("Eszköz szűrő: RGBW VEZÉRLŐ");
					ftb.style.backgroundImage = 'url(img/icon_RGBW.svg)';
				}
				if (nr == 'e')
				{
					generalFilerValue = "SP";
					executeFilter("SP");
					logging("Eszköz szűrő: OKOS KONNEKTOR");
					ftb.style.backgroundImage = 'url(img/icon_SP.svg)';
				}
				if (nr == 'f')
				{
					generalFilerValue = "WS";
					executeFilter("WS");
					logging("Eszköz szűrő: HŐMÉRŐ");
					ftb.style.backgroundImage = 'url(img/icon_WS.svg)';
				}
				if (nr == 'g')
				{
					generalFilerValue = "none";
					executeFilter("none");
					logging("Eszköz szűrő: kikapcsolva");
					ftb.style.backgroundImage = 'url(img/null.svg)';
				}
				
				var storage = window.localStorage;
				settingsLastFilter = nr;
				storage.setItem('settingsLastFilter', settingsLastFilter);
				
				reset();
				PieMenuInit();
			}
			
				
			
			
			function logging(logTxt){
				document.getElementById('log').innerHTML = logTxt;
			}
			
			var idobelyeg;
			
			function logginToLog(logTxt) {
				var dt = new Date();
				idobelyeg = dt.toUTCString();
				document.getElementById('logTxtDiv').innerHTML = idobelyeg + " | " + logTxt + '<br>' + document.getElementById('logTxtDiv').innerHTML;
			}
			
			function snodeDeviceCommand(ID) {
				var cloudStatusI = document.getElementById('cloudStatus');
				var deviceName = document.getElementById('kocka' + ID + 'nev').innerHTML;	//<--	eszköz, amire a parancsot kuldom
				var deviceTpye = document.getElementById('kocka' + ID + 'type').innerHTML;	//<--	eszköz, amire a parancsot kuldom
				var commandTxt = "empty";
				//idojaras allomas
				if (deviceTpye == "WS") { commandTxt = "snodeControlThisDevice:" + deviceName + ";snodeControlCommand:sendMeActualConditions";}
				if (deviceTpye == "DROP") { commandTxt = "snodeControlThisDevice:" + deviceName.replace('DROP','WS') + ";snodeControlCommand:sendMeActualConditions";}
				
				if (deviceTpye == "SP") { 
					var actualPlugState = document.getElementById('kocka' + ID + 'ertek').innerHTML;
					if (actualPlugState == 'BE') { commandTxt = "snodeControlThisDevice:" + deviceName + ";snodeControlCommand:setStateOff";}
					if (actualPlugState == 'KI') { commandTxt = "snodeControlThisDevice:" + deviceName + ";snodeControlCommand:setStateOn";}
				}
				
				if (deviceTpye == "RGBW") { commandTxt = "snodeControlThisDevice:" + deviceName + ";snodeControlCommand:sendMeActualConditions";}
				
				logging("Frissítés: " + deviceName + "...");
				cloudStatusI.style.backgroundImage = 'url(img/cloudSrefresh.svg)';
				cordova.plugins.CordovaMqTTPlugin.publish({
							   topic:settingsMqttTopic,
							   payload:commandTxt,
							   qos:0,
							   retain:false,
							  success:function(s){
								//alert("elküldve a tellMeYourSnodeStatus szöveg");
								logginToLog("parancs küldve: " + commandTxt);				
								cloudStatusI.style.backgroundImage = 'url(img/cloudSonline.svg)';
							  },
							  error:function(e){
								logginToLog("--- HIBA az snode eszközök vezérlése során! ---");
								cloudStatusI.style.backgroundImage = 'url(img/cloudSoffline.svg)';
							  }
							});
			
			}

			function resetKockas() {
				for (var i=10; i> 10; i--) {
					document.getElementById('kocka' + i).style.display = 'none';
					document.getElementById('kocka' + i + 'type').innerHTML = 'ismeretlen';
					document.getElementById('kocka' + i + 'ertek').innerHTML = '...';
					document.getElementById('kocka' + i + 'erteks').innerHTML = '';
					document.getElementById('kocka' + i + 'nev').innerHTML = 'nincs_nev';
					document.getElementById('kocka' + i + 'szoba').innerHTML = 'OTTHON';
				
				}
			}
		
			function refreshEverything() {
				//nezzuk meg ez mit mutat; eltuntetunk minden kockat
				resetKockas();
				//es mindent megprobalunk elorol, mintha most toltenenk be; egyenlore csak gombbal, mert nem akarom folyamatosan ujrakapcsolni
				//de lehene akar az alabbi fuggveny onConnectionLost eseményénél is egy ujracsatlakozas
				connectAndRefreshCloud();
			}
			
			
			function scanQRcode(){
				document.getElementById('scanBtn').innerHTML = "Kamera indítása folyamatban...";
				 cordova.plugins.barcodeScanner.scan(
				  function (result) {
					  
					setTimeout(function(){
						document.getElementById('scanBtn').innerHTML = "Beállítások szkennelése QR kódról";
					},500);
					  
					  if (result.text.indexOf('snodeConfig') != -1){
						var resultArray = result.text.split(';');
						document.getElementById('settingsMqttServerInput').value = resultArray[1].replace('server:','').replace(';','');
						document.getElementById('settingsMqttPortInput').value = resultArray[2].replace('port:','').replace(';','');
						document.getElementById('settingsMqttUserInput').value = resultArray[3].replace('user:','').replace(';','');
						document.getElementById('settingsMqttPwdInput').value = resultArray[4].replace('password:','').replace(';','');
						document.getElementById('settingsMqttTopicInput').value = resultArray[5].replace('topic:','').replace(';','');
						alert("Beállítások beolvasva! A mentéshez koppints a 'Mentés' gombra");
					  }
					  else {
						alert('A QR kód nem tartalmaz snode beállításokat!');
					  }
					  
					//alert("We got a barcode\n" +
					//"Result: " + result.text + "\n" +
					//"Format: " + result.format + "\n" +
					//"Cancelled: " + result.cancelled);
				  },
				  function (error) {
					  alert("Hiba a szkennelés során: " + error);
				  }
			   );
			
			}
	</script>
		
		<div id="main">
			
			
			<div id="headerImg" class="bgr"></div>
			<!--<div onclick="resetKockas()">test</div>-->
			<!--<div id="settings2">Beállítások</div>-->
			<!--background-image:url('img/cloud_bgw.jpg');background-size:100% 100%;-->
			<div id="mainTileContent" name="mainTileContent" style="min-height:90vh;padding-bottom:120px;" class="linewithshadow">
				<!-- celsuis: &#x2103; -->
				<div id="kocka1" name="kocka1" class="kocka" style="display:none;">
					<div id="kocka1type" name="kocka1type" style="display:none">ismeretlen</div>
					<div id="kocka1iconConatiner" name="kocka1iconConatiner" class="ikon"><img id="kocka1icon" name="kocka1icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka1ertek" name="kocka1ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka1ertekS" name="kocka1ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka1nev" name="kocka1nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka1szoba" name="kocka1szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka2" name="kocka2" class="kocka" style="display:none;">
					<div id="kocka2type" name="kocka2type" style="display:none">ismeretlen</div>
					<div id="kocka2iconConatiner" name="kocka2iconConatiner" class="ikon"><img id="kocka2icon" name="kocka2icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka2ertek" name="kocka2ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka2ertekS" name="kocka2ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka2nev" name="kocka2nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka2szoba" name="kocka2szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka3" name="kocka3" class="kocka" style="display:none;">
					<div id="kocka3type" name="kocka3type" style="display:none">ismeretlen</div>
					<div id="kocka3iconConatiner" name="kocka3iconConatiner" class="ikon"><img id="kocka3icon" name="kocka3icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka3ertek" name="kocka3ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka3ertekS" name="kocka3ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka3nev" name="kocka3nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka3szoba" name="kocka3szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka4" name="kocka4" class="kocka" style="display:none;">
					<div id="kocka4type" name="kocka4type" style="display:none">ismeretlen</div>
					<div id="kocka4iconConatiner" name="kocka4iconConatiner" class="ikon"><img id="kocka4icon" name="kocka4icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka4ertek" name="kocka4ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka4ertekS" name="kocka4ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka4nev" name="kocka4nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka4szoba" name="kocka4szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka5" name="kocka5" class="kocka" style="display:none;">
					<div id="kocka5type" name="kocka5type" style="display:none">ismeretlen</div>
					<div id="kocka5iconConatiner" name="kocka5iconConatiner" class="ikon"><img id="kocka5icon" name="kocka5icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka5ertek" name="kocka5ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka5ertekS" name="kocka5ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka5nev" name="kocka5nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka5szoba" name="kocka5szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka6" name="kocka6" class="kocka" style="display:none;">
					<div id="kocka6type" name="kocka6type" style="display:none">ismeretlen</div>
					<div id="kocka6iconConatiner" name="kocka6iconConatiner" class="ikon"><img id="kocka6icon" name="kocka6icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka6ertek" name="kocka6ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka6ertekS" name="kocka6ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka6nev" name="kocka6nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka6szoba" name="kocka6szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka7" name="kocka7" class="kocka" style="display:none;">
					<div id="kocka7type" name="kocka7type" style="display:none">ismeretlen</div>
					<div id="kocka7iconConatiner" name="kocka7iconConatiner" class="ikon"><img id="kocka7icon" name="kocka7icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka7ertek" name="kocka7ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka7ertekS" name="kocka7ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka7nev" name="kocka7nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka7szoba" name="kocka7szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka8" name="kocka8" class="kocka" style="display:none;">
					<div id="kocka8type" name="kocka8type" style="display:none">ismeretlen</div>
					<div id="kocka8iconConatiner" name="kocka8iconConatiner" class="ikon"><img id="kocka8icon" name="kocka8icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka8ertek" name="kocka8ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka8ertekS" name="kocka8ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka8nev" name="kocka8nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka8szoba" name="kocka8szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka9" name="kocka9" class="kocka" style="display:none;">
					<div id="kocka9type" name="kocka9type" style="display:none">ismeretlen</div>
					<div id="kocka9iconConatiner" name="kocka9iconConatiner" class="ikon"><img id="kocka9icon" name="kocka9icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka9ertek" name="kocka9ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka9ertekS" name="kocka9ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka9nev" name="kocka9nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka9szoba" name="kocka9szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				<div id="kocka10" name="kocka10" class="kocka" style="display:none;">
					<div id="kocka10type" name="kocka10type" style="display:none">ismeretlen</div>
					<div id="kocka10iconConatiner" name="kocka10iconConatiner" class="ikon"><img id="kocka10icon" name="kocka10icon" class="ikonImg" src="img/logo.svg"></div>
					<h1 id="kocka10ertek" name="kocka10ertek" style="margin-left:15px;margin-top:8px;font-size:26px;letter-spacing: 1.5px;color:#6d6d6d;display:inline-block">...</h1><div id="kocka10ertekS" name="kocka10ertekS" style="font-size:16px;display:inline;color:#6d6d6d;"></div>
					<div id="kocka10nev" name="kocka10nev" style="margin-left:15px;font-size:18px;margin-top:-14px;letter-spacing:-1px;color:#111;">nincs_nev</div>
					<div id="kocka10szoba" name="kocka10szoba" style="margin-left:15px;font-size:12px;margin-top:-4px;letter-spacing:-1px;color:#404040;font-weight: 700 !important;">OTTHON</div>
				</div>
				
				
				
									
				<!--<center><div class="beallitasokBtn" onclick="showSettings()"><h2 style="font-size:16px;">Beállítások...</h2></div></center>-->
				
				
				
			</div>
		
		<div name="cloudStatus" id="cloudStatus" onclick="showWheel()" style="position:absolute; right: 10px; top: 10px;height:24px;width:32px;background-image:url('img/cloudSoffline.svg');"></div> 
		
		<div id="footer" name="footer">
			<div style=" text-align: center;margin-left:-48px;">
				<div id='outer_container' class="outer_container animated zoomIn" style="display: inline-block;">
					<a class="menu_button" href="#" title="Filter"><span id="filterToggleBtn" style="margin-left:-4px;margin-top:-4px;background-image:url('img/null.svg');">Menu Toggle</span></a>
					<ul class="menu_option">
					  <li><a href="#"><span onclick="setFilter('a')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/icon_DROP_w.svg');">1</span></a></li>
					  <li><a href="#"><span onclick="setFilter('b')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/icon_POWER_w.svg');">2</span></a></li>
					  <li><a href="#"><span onclick="setFilter('c')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/icon_RF_w.svg');">3</span></a></li>
					  <li><a href="#"><span onclick="setFilter('d')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/icon_RGBW_w.svg');">4</span></a></li>
					  <li><a href="#"><span onclick="setFilter('e')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/icon_SP_w.svg');">5</span></a></li>
					  <li><a href="#"><span onclick="setFilter('f')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/icon_WS_w.svg');">6</span></a></li>
					  <li><a href="#"><span onclick="setFilter('g')" style="margin-left:-8px;margin-top:-8px;background-image:url('img/disable_w.svg');">7</span></a></li>
					</ul>
				</div>
				</div>
			
			<center><div id="log" name="log">Kezelőfelület betöltése...</div><center>
		
			<div style="display: flex;padding-bottom:4px; padding-top:5px;background:#f5f5f5;border-top: 1px solid #d6d6d6;">
				
				
				
				
				<div style="flex: 1;text-align:center;">
					<div name="btn_settings" class="settingsBtn" id="btn_settings" onclick="showSettings()"><img id="btn_settingsImg" src="img/settings.svg" style="height:20px;"></div> 
				</div>
						
				
				<div style="flex: 1;text-align:center;">
					<div name="btn_refresh" class="settingsBtn" id="btn_refresh" onclick="refreshEverything()"><img alt="node kereses" src="img/refresh.svg" style="height:20px;"></div> 
				</div>
				
				<div style="flex: 1;text-align:center;">
					<div name="btn_Wifi" class="settingsBtn" id="btn_Wifi" onclick="switchToWifiService()"><img alt="wifi service" src="img/wifi.svg" style="height:20px;"></div> 
				</div>
			
			</div>
		
		</div>
		
		</div>
		
		<script>
					
			var pressTimer;
			var longpress = '0';
			var nodeNameToReplace = 'ures';
			var nodeNameToReplaceAlt = 'ures';
			//onclick="snodeDeviceCommand('1')"
			
			//$("#kocka1").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('1');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('1'); },1000);});
			//$("#kocka2").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('2');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('2'); },1000);});
			//$("#kocka3").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('3');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('3'); },1000);});
			//$("#kocka4").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('4');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('4'); },1000);});
			//$("#kocka5").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('5');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('5'); },1000);});
			//$("#kocka6").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('6');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('6'); },1000);});
			//$("#kocka7").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('7');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('7'); },1000);});
			//$("#kocka8").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('8');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('8'); },1000);});
			//$("#kocka9").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('9');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('9'); },1000);});
			//$("#kocka10").mouseup(function(){ clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('10');}; longpress='0'; }).mousedown(function(){ pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('10'); },1000);});
			
			//e.preventDefault();
			$("#kocka1").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('1');}	longpress='0'; });
			$("#kocka1").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('1'); },1000); });
			
			$("#kocka2").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('2');}	longpress='0'; });
			$("#kocka2").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('2'); },1000); });
			
			$("#kocka3").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('3');}	longpress='0'; });
			$("#kocka3").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('3'); },1000); });
			
			$("#kocka4").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('4');}	longpress='0'; });
			$("#kocka4").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('4'); },1000); });
			
			$("#kocka5").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('5');}	longpress='0'; });
			$("#kocka5").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('5'); },1000); });
			
			$("#kocka6").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('6');}	longpress='0'; });
			$("#kocka6").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('6'); },1000); });
			
			$("#kocka7").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('7');}	longpress='0'; });
			$("#kocka7").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('7'); },1000); });
			
			$("#kocka8").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('8');}	longpress='0'; });
			$("#kocka8").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('8'); },1000); });
			
			$("#kocka9").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('9');}	longpress='0'; });
			$("#kocka9").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('9'); },1000); });
			
			$("#kocka10").on('touchend mouseup', function(e) {clearTimeout(pressTimer); if (longpress=='0'){snodeDeviceCommand('10');}	longpress='0'; });
			$("#kocka10").on('touchstart mousedown', function(e) { pressTimer = window.setTimeout(function() {longpress='1'; showDeviceDetails('10'); },1000); });
			
				
			
			
			function showDeviceDetails(id) {
				var deviceName = document.getElementById('kocka' + id + 'nev').innerHTML;
				nodeNameToReplace = deviceName + ';';
				nodeNameToReplaceAlt = deviceName.replace('_DROP','_WS') + ';';
				var tipus = document.getElementById('kocka' + id + 'type').innerHTML;
				
				if (tipus == "WS" || tipus == "DROP") {
					document.getElementById('wsName').innerHTML = deviceName;
					var devicenameArr = deviceName.split('_');
					var devMainNameTemperature = devicenameArr[0] + '_WS';
					var devMainNameHumidity = devicenameArr[0] + '_DROP';
					
					//irjuk be az akutalis adatokat
					for (var i = 1; i<=10; i++)
					{
						if (document.getElementById('kocka' + i + 'nev').innerHTML.indexOf(devMainNameTemperature) != -1) {document.getElementById('actualTemp').innerHTML = document.getElementById('kocka' + i + 'ertek').innerHTML;}
						if (document.getElementById('kocka' + i + 'nev').innerHTML.indexOf(devMainNameHumidity) != -1) {document.getElementById('actualHumidity').innerHTML = document.getElementById('kocka' + i + 'ertek').innerHTML;}
					}
					
					
					var commandTxtHistorie = 'snodeControlThisDevice:' + deviceName.replace('_DROP','_WS') + ';snodeControlCommand:sendMeYourHistory';
					
					cordova.plugins.CordovaMqTTPlugin.publish({
							   topic:settingsMqttTopic,
							   payload:commandTxtHistorie,
							   qos:0,
							   retain:false,
							  success:function(s){
								//alert("elküldve a tellMeYourSnodeStatus szöveg");
								logginToLog("parancs küldve: " + commandTxt);				
								//cloudStatusI.style.backgroundImage = 'url(img/cloudSonline.svg)';
								
								//a valasz ugye nem ide fog jonni, hanem a listen-es részre 						
								
							  },
							  error:function(e){
								logginToLog("--- HIBA az snode eszközök vezérlése során! ---");
								//cloudStatusI.style.backgroundImage = 'url(img/cloudSoffline.svg)';
							  }
							});
					
					
					
					
					showModalWS();
					
					
					
					setTimeout(function(){
						document.getElementById('btnWS_last4hours').click();
					},500);
					
					
					logging('Részletek lekérdezése: ' + deviceName);
				}
				else {
					return;
				}
				
				
			}
			
			var wsChart;
			
			function UpdateSnodeWSHistorie24h() {
				var valaszStr = String(valaszHistorie).replace(nodeNameToReplace,'').replace(nodeNameToReplaceAlt,'');
				var lines = valaszStr.split("|"); 

				//logginToLog('UpdateSnodeWSHistorie24h:');
				//logginToLog('nodeNameToReplace: ' + nodeNameToReplace);
				//logginToLog('valaszHistorie: ' + nodeNameToReplace );
				//logginToLog('lines hossza: ' + lines.lenght);
				var ertekek_homerseklet = [];
				var ertekek_paratartalom = [];
				var felirat = [];
				//logginToLog('for ciklus kezdete');
				var i = 12;
				for (i = 12; i > 0; i--) {
				var feliratInt = i-12;
				if (feliratInt == 0 ) { felirat[i] = "most";} 
					else
					{
					if (feliratInt % 3 == 0)
					{
						felirat[i] = String(feliratInt / 3) + 'ó';
					}
						else
						{
							felirat[i] = "";
						}
					}
					var reszertek = lines[12-i].split(";");
					ertekek_homerseklet[i] = reszertek[0];
					ertekek_paratartalom[i] = reszertek[1];
					//logginToLog(i + ' -> homerseklet = ' + reszertek[0] + ' paratartalom:' + reszertek[1]);
				} 
				logginToLog('chart rajzolasa');
				document.getElementById('actualChartType').innerHTML = "utolsó 4 óra adatai";
				//es most chart rajzolasa
				var ctx = document.getElementById('myChart').getContext("2d");
				if (wsChart != null) 
				{
					//wsChart.destroy();
					wsChart.data.labels = felirat;
					wsChart.data.datasets[0].data = ertekek_homerseklet;
					wsChart.data.datasets[1].data = ertekek_paratartalom;
					wsChart.update();
					return;
				}
				wsChart = new Chart(ctx, {
					type: 'line',
					data: {
					labels: felirat,
					datasets: [{
					label: 'hőmérséklet [Celsius]',
					borderColor: 'rgba(0, 255, 0, 0.6)',
					backgroundColor: 'rgba(0, 255, 0, 0.1)',
					yAxisID: 'A',
					data: ertekek_homerseklet,
					pointRadius: 0
				}, {
					label: 'páratartalom [%]',
					yAxisID: 'B',
					borderColor: 'rgba(0, 0, 255, 0.6)',
					backgroundColor: 'rgba(0, 0, 255, 0.1)',
					data: ertekek_paratartalom,
					pointRadius: 0
					}]
					},
					options: {
					  responsive: true,
					  stacked: false,
					  animation: {
					  duration: 1000,
					  easing: 'easeInOutExpo',
					},
					hoverMode: 'index',
					stacked: false,
					scales: {
					  yAxes: [{
					  id: 'A',
					  type: 'linear',
					  position: 'left',
					}, {
					  id: 'B',
					  type: 'linear',
					  position: 'right',
					 }]
					}
				  }
				});
			}
			
			function UpdateSnodeWSHistorie3d() {
				var valaszStr = String(valaszHistorie).replace(nodeNameToReplace,'').replace(nodeNameToReplaceAlt,'');
				var lines = valaszStr.split("|"); 

				logginToLog('UpdateSnodeWSHistorie3d');
				var ertekek_homerseklet = [];
				var ertekek_paratartalom = [];
				var felirat = [];
				
				var i = 24;
				for (i = 24; i > 0; i--) {
					var feliratInt = i-24;
					if (feliratInt == 0 ) { felirat[i] = "most";} 
					else
					{
						if (feliratInt % 3 == 0)
						{
							felirat[i] = String(feliratInt / 3) + 'ó';
						}
						else
						{
							felirat[i] = "";
						}
					}
					var reszertek = lines[24-i].split(";");
					ertekek_homerseklet[i] = reszertek[0];
					ertekek_paratartalom[i] = reszertek[1];
				} 
										
				//es most chart rajzolasa
				document.getElementById('actualChartType').innerHTML = "utolsó 8 óra adatai";
				var ctx = document.getElementById('myChart').getContext("2d");
				if (wsChart != null) 
				{
					//wsChart.destroy();
					wsChart.data.labels = felirat;
					wsChart.data.datasets[0].data = ertekek_homerseklet;
					wsChart.data.datasets[1].data = ertekek_paratartalom;
					wsChart.update();
					return;
				}
				wsChart = new Chart(ctx, {
					type: 'line',
					data: {
					labels: felirat,
					datasets: [{
					label: 'hőmérséklet [Celsius]',
					borderColor: 'rgba(0, 255, 0, 0.6)',
					backgroundColor: 'rgba(0, 255, 0, 0.1)',
					yAxisID: 'A',
					data: ertekek_homerseklet,
					pointRadius: 0
				}, {
					label: 'páratartalom [%]',
					yAxisID: 'B',
					borderColor: 'rgba(0, 0, 255, 0.6)',
					backgroundColor: 'rgba(0, 0, 255, 0.1)',
					data: ertekek_paratartalom,
					pointRadius: 0
					}]
					},
					options: {
					  responsive: true,
					  stacked: false,
					  animation: {
					  duration: 1000,
					  easing: 'easeInOutExpo',
					},
					hoverMode: 'index',
					stacked: false,
					scales: {
					  yAxes: [{
					  id: 'A',
					  type: 'linear',
					  position: 'left',
					}, {
					  id: 'B',
					  type: 'linear',
					  position: 'right',
					 }]
					}
				  }
				});
			}
			
			function UpdateSnodeWSHistorie7d() {
				var valaszStr = String(valaszHistorie).replace(nodeNameToReplace,'').replace(nodeNameToReplaceAlt,'');
				var lines = valaszStr.split("|"); 

				logginToLog('UpdateSnodeWSHistorie7d');
				var ertekek_homerseklet = [];
				var ertekek_paratartalom = [];
				var felirat = [];
				
				var i = 36;
				for (i = 36; i > 0; i--) {
				var feliratInt = i-36;
				if (feliratInt == 0 ) { felirat[i] = "most";} 
				else
				{
					if (feliratInt % 3 == 0)
					{
						felirat[i] = String(feliratInt / 3) + 'ó';
					}
					else
					{
						felirat[i] = "";
					}
				}
				var reszertek = lines[36-i].split(";");
				ertekek_homerseklet[i] = reszertek[0];
				ertekek_paratartalom[i] = reszertek[1];
				} 
										
				//es most chart rajzolasa
				document.getElementById('actualChartType').innerHTML = "utolsó 12 óra adatai";
				var ctx = document.getElementById('myChart').getContext("2d");
				if (wsChart != null) 
				{
					//wsChart.destroy();
					wsChart.data.labels = felirat;
					wsChart.data.datasets[0].data = ertekek_homerseklet;
					wsChart.data.datasets[1].data = ertekek_paratartalom;
					wsChart.update();
					return;
				}
				wsChart = new Chart(ctx, {
					type: 'line',
					data: {
					labels: felirat,
					datasets: [{
					label: 'hőmérséklet [Celsius]',
					borderColor: 'rgba(0, 255, 0, 0.6)',
					backgroundColor: 'rgba(0, 255, 0, 0.1)',
					yAxisID: 'A',
					data: ertekek_homerseklet,
					pointRadius: 0
				}, {
					label: 'páratartalom [%]',
					yAxisID: 'B',
					borderColor: 'rgba(0, 0, 255, 0.6)',
					backgroundColor: 'rgba(0, 0, 255, 0.1)',
					data: ertekek_paratartalom,
					pointRadius: 0
					}]
					},
					options: {
					  responsive: true,
					  stacked: false,
					  animation: {
					  duration: 1000,
					  easing: 'easeInOutExpo',
					},
					hoverMode: 'index',
					stacked: false,
					scales: {
					  yAxes: [{
					  id: 'A',
					  type: 'linear',
					  position: 'left',
					}, {
					  id: 'B',
					  type: 'linear',
					  position: 'right',
					 }]
					}
				  }
				});
			}
			
		</script>
		
    </body>
</html>
